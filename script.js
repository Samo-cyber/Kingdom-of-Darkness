const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;if (prefersReducedMotion) {document.documentElement.classList.add('reduced-motion');}/* Global brand colors from CSS variables */const styles = getComputedStyle(document.documentElement);const BRAND_RED = styles.getPropertyValue('--brand-red').trim();const BRAND_ACCENT = styles.getPropertyValue('--brand-accent').trim();const TEXT_LIGHT = styles.getPropertyValue('--text-light').trim();const BRAND_BG = styles.getPropertyValue('--brand-bg').trim();/* --- Cursor Layer --- */const cursorCanvas = document.querySelector('.cursor-layer');const ctx = cursorCanvas.getContext('2d');let mouseX = 0;let mouseY = 0;let targetX = 0;let targetY = 0;const trail = [];const particles = [];function resizeCanvas() {cursorCanvas.width = window.innerWidth;cursorCanvas.height = window.innerHeight;}window.addEventListener('resize', resizeCanvas);resizeCanvas();document.addEventListener('mousemove', (e) => {mouseX = e.clientX;mouseY = e.clientY;});const cursorDot = {x: 0,y: 0,radius: 6,color: BRAND_RED};function animateCursor() {if (prefersReducedMotion) return;targetX += (mouseX - targetX) * 0.1;targetY += (mouseY - targetY) * 0.1;cursorDot.x = targetX;cursorDot.y = targetY;trail.push({ x: targetX, y: targetY, opacity: 1, life: 140 });// Remove old trail segmentsfor (let i = 0; i < trail.length; i++) {trail[i].life -= 16; // Adjust for ~60fps - 1000/60 ~ 16.6ms// Fade outtrail[i].opacity = trail[i].life / 140;if (trail[i].life <= 0) {trail.splice(i, 1);i--;}}ctx.clearRect(0, 0, cursorCanvas.width, cursorCanvas.height);ctx.globalCompositeOperation = 'lighter'; // For glow effect// Draw trailfor (let i = 0; i < trail.length; i++) {const segment = trail[i];ctx.beginPath();ctx.arc(segment.x, segment.y, cursorDot.radius / 2 * (segment.life / 140), 0, Math.PI * 2);ctx.fillStyle = `rgba(${parseInt(BRAND_RED.slice(1, 3), 16)}, ${parseInt(BRAND_RED.slice(3, 5), 16)}, ${parseInt(BRAND_RED.slice(5, 7), 16)}, ${segment.opacity * 0.18})`;ctx.fill();}// Draw custom dotctx.beginPath();ctx.arc(cursorDot.x, cursorDot.y, cursorDot.radius, 0, Math.PI * 2);ctx.fillStyle = BRAND_RED;ctx.shadowBlur = 10;ctx.shadowColor = `rgba(${parseInt(BRAND_RED.slice(1, 3), 16)}, ${parseInt(BRAND_RED.slice(3, 5), 16)}, ${parseInt(BRAND_RED.slice(5, 7), 16)}, 0.14)`;ctx.fill();ctx.shadowBlur = 0;ctx.globalCompositeOperation = 'source-over';requestAnimationFrame(animateCursor);}animateCursor();/* Floating Particles (sparse, drift down) */function createParticle() {if (prefersReducedMotion) return;particles.push({x: Math.random() * cursorCanvas.width,y: Math.random() * cursorCanvas.height,size: Math.random() * 2 + 1,opacity: Math.random() * 0.5 + 0.3,speedY: Math.random() * 0.5 + 0.2,});}setInterval(createParticle, 500); // Sparse densityfunction animateParticles() {if (prefersReducedMotion) return;ctx.clearRect(0, 0, cursorCanvas.width, cursorCanvas.height);for (let i = 0; i < particles.length; i++) {const p = particles[i];p.y += p.speedY;p.x += (Math.random() - 0.5) * 0.5; // Slight horizontal driftif (p.y > cursorCanvas.height) {p.y = -p.size;p.x = Math.random() * cursorCanvas.width;}ctx.beginPath();ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);ctx.fillStyle = `rgba(255, 255, 255, ${p.opacity})`;ctx.fill();}requestAnimationFrame(animateParticles);}// Temporarily disable particle animation if cursor effects handle the canvas update. If separate canvas, use this.if (!prefersReducedMotion) {animateParticles(); // Needs a dedicated canvas or merged into cursorCanvas loop for performance}/* --- Howler.js Sound System --- */let globalAmbientSound;let whisperSound;let flickerSound;let soundEnabled = false;const soundConsentModal = document.querySelector('.sound-consent-modal');const enableSoundBtn = document.getElementById('enableSoundBtn');const disableSoundBtn = document.getElementById('disableSoundBtn');function initSounds() {if (prefersReducedMotion) return;Howler.autoUnlock = false;globalAmbientSound = new Howl({src: ['https://assets.mixkit.co/sfx/preview/mixkit-wind-sweeping-160.ogg'], // Placeholderloop: true,volume: 0.04, // -24dB is roughly 0.063, but 0.04 is softerhtml5: true,});whisperSound = new Howl({src: ['https://assets.mixkit.co/sfx/preview/mixkit-ominous-whip-sound-2008.ogg'], // Placeholder - short whispervolume: 0.1, //-18dB is roughly 0.125html5: true,});flickerSound = new Howl({src: ['https://assets.mixkit.co/sfx/preview/mixkit-light-flicker-166.ogg'], // Placeholder - flicker clickvolume: 0.1, // -20dB is roughly 0.1html5: true,});}enableSoundBtn.addEventListener('click', () => {soundEnabled = true;soundConsentModal.classList.add('hidden');if (!prefersReducedMotion) {initSounds();globalAmbientSound.play();}});disableSoundBtn.addEventListener('click', () => {soundConsentModal.classList.add('hidden');console.log('Sound disabled by user.');});// Show modal on page load to ask for consentwindow.addEventListener('load', () => {if (prefersReducedMotion) {soundConsentModal.classList.add('hidden');} else {soundConsentModal.classList.remove('hidden');}});/* --- GSAP Animations --- */gsap.registerPlugin();const heroTitle = document.querySelector('.hero-section .title');const heroSubtitle = document.querySelector('.hero-section .subtitle');const heroCta = document.querySelector('.cta-button');const heroLogo = document.querySelector('.hero-section .logo');const heroFog = document.querySelector('.hero-background-fog');const heroGlow = document.querySelector('.hero-background-glow');const heroSpotlight = document.querySelector('.hero-background-spotlight');const storyCards = gsap.utils.toArray('.story-card');const tl = gsap.timeline({defaults: {ease: 'power3.out'}});tl.from(heroLogo, {opacity: 0, y: -50, duration: 1}, 0.5).from(heroTitle, {opacity: 0, y: -24, duration: 1.2, stagger: 0.06}, "-=0.8").from(heroSubtitle, {opacity: 0, y: -20, duration: 1}, "-=0.6").from(heroCta, {opacity: 0, scale: 0.8, duration: 0.8}, "-=0.4").from([heroFog, heroGlow, heroSpotlight], {opacity: 0, duration: 1.6}, 0);/* Mouse Parallax for Hero */if (!prefersReducedMotion) {document.addEventListener('mousemove', (e) => {const x = e.clientX / window.innerWidth - 0.5;const y = e.clientY / window.innerHeight - 0.5;gsap.to(heroTitle, {x: x * 40, y: y * 30, duration: 1.5, ease: 'power2.out'});gsap.to(heroSubtitle, {x: x * 30, y: y * 25, duration: 1.5, ease: 'power2.out'});gsap.to(heroLogo, {x: x * 20, y: y * 15, duration: 1.5, ease: 'power2.out'});gsap.to(heroCta, {x: x * 15, y: y * 10, duration: 1.5, ease: 'power2.out'});gsap.to(heroFog, {x: x * 10, y: y * 8, duration: 1.8, ease: 'power2.out'}); // fog: 0.04 * 200 = 8pxgsap.to(heroGlow, {x: x * 4, y: y * 3, duration: 1.8, ease: 'power2.out'});gsap.to(heroSpotlight, {x: x * 2, y: y * 1, duration: 1.8, ease: 'power2.out'}); // bg: 0.01 * 200 = 2px});}/* Story Card Hover Effects */storyCards.forEach(card => {const image = card.querySelector('img');const bloodCrack = card.querySelector('.blood-crack-line');card.addEventListener('mouseenter', () => {if (soundEnabled && whisperSound && !prefersReducedMotion) {whisperSound.play();}gsap.to(image, {filter: 'brightness(0.76)', duration: 0.4});gsap.fromTo(bloodCrack, {opacity: 0, scale: 0.8, y: -10}, {opacity: 1, scale: 1, y: 0, duration: 0.45, ease: 'power2.out'});});card.addEventListener('mouseleave', () => {gsap.to(image, {filter: 'brightness(1)', duration: 0.3});gsap.to(bloodCrack, {opacity: 0, duration: 0.3});});});/* Light Flicker Logic */function startLightFlicker() {if (prefersReducedMotion) return;setInterval(() => {const shouldFlicker = Math.random() < 0.2; // ~1 in 5 chance to flicker every average intervalif (shouldFlicker) {const duration = Math.random() * 0.6; // Max 0.6sglobalAmbientSound.fade(globalAmbientSound.volume(), globalAmbientSound.volume() * 0.5, duration * 500); // Muffle ambient gsap.to(document.body, {filter: 'brightness(0.8)', duration: duration * 0.5, yoyo: true, repeat: 1, ease: 'steps(1)', onComplete: () => {gsap.to(document.body, {filter: 'brightness(1)', duration: 0.1});}});if (soundEnabled && flickerSound) {flickerSound.play();}}}, 8000); // Average interval 8 seconds}if (!prefersReducedMotion) {startLightFlicker();}/* Eye Cursor for Interactive Elements (conceptual, requires SVG/more complex drawing) */document.querySelectorAll('button, a, .story-card').forEach(el => {el.addEventListener('mouseenter', () => {document.body.classList.add('interactive-cursor');});el.addEventListener('mouseleave', () => {document.body.classList.remove('interactive-cursor');});});